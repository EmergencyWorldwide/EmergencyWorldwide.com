<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Worldwide</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            display: flex;
            flex-direction: column;
        }
        .container {
            display: flex;
            width: 100%;
        }
        .left-section {
            width: 75%;
            padding: 20px;
        }
        .right-section {
            width: 25%;
            background: #1e1e1e;
            padding: 15px;
            height: 100vh;
            overflow-y: auto;
            border-left: 2px solid #333;
        }
        #map {
            height: 500px;
            width: 100%;
            border-radius: 10px;
        }
        .details-menu {
            display: none;
            position: fixed;
            right: 0;
            top: 0;
            width: 300px;
            height: 100%;
            background: #222;
            color: white;
            padding: 20px;
            box-shadow: -5px 0 10px rgba(0, 0, 0, 0.2);
        }
        .close-btn {
            background-color: red;
            color: white;
            border: none;
            padding: 8px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="left-section">
        <h1>üö® Emergency Worldwide</h1>
        <div id="map"></div>
        <button onclick="startPlacing('Fire Station')">üî• Place Fire Station</button>
        <button onclick="startPlacing('Fire Engine')">üöí Place Fire Engine</button>
        <button onclick="startPlacing('DMO Shed')">üîß Place DMO Shed</button>
    </div>

    <div class="right-section">
        <h2>üìü MDT - Mission List</h2>
        <div id="missions-list">No Active Missions</div>
        <h2>üí∞ Balance: $<span id="balance">1000000</span></h2>
    </div>
</div>

<!-- Details Menu -->
<div id="details-menu" class="details-menu">
    <button class="close-btn" onclick="closeDetailsMenu()">‚ùå Close</button>
    <h2 id="details-title"></h2>
    <p id="details-info"></p>
    <button onclick="renameBuilding()">‚úè Rename</button>
    <button onclick="viewFullDetails()">üìÑ View Full Details</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    let map = L.map('map').setView([-37.8136, 144.9631], 12);  
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let balance = 1000000;
    let buildings = [];
    let vehicles = [];
    let markers = [];
    let placingType = null;
    let selectedBuilding = null;

    function startPlacing(type) {
        placingType = type;
        alert(`Click on the map to place a ${type}.`);
    }

    map.on('click', function(event) {
        if (!placingType) return;

        let latlng = event.latlng;
        let newMarker = L.marker(latlng).addTo(map)
            .bindPopup(`${placingType} - Click to view details`)
            .on('click', function() {
                openDetailsMenu(this);
            });

        let markerData = {
            type: placingType,
            location: latlng,
            name: `${placingType} at ${latlng.lat.toFixed(3)}, ${latlng.lng.toFixed(3)}`
        };

        markers.push({ marker: newMarker, data: markerData });
        buildings.push(markerData);

        placingType = null;
        saveProgress();
    });

    function openDetailsMenu(marker) {
        let markerData = markers.find(m => m.marker === marker);
        if (!markerData) return;

        selectedBuilding = markerData.data;
        document.getElementById('details-title').innerText = selectedBuilding.name;
        document.getElementById('details-info').innerHTML = `
            üìç Location: ${selectedBuilding.location.lat.toFixed(3)}, ${selectedBuilding.location.lng.toFixed(3)}
        `;
        document.getElementById('details-menu').style.display = 'block';
    }

    function closeDetailsMenu() {
        document.getElementById('details-menu').style.display = 'none';
    }

    function renameBuilding() {
        if (!selectedBuilding) return;
        let newName = prompt("Enter new name:");
        if (newName) {
            selectedBuilding.name = newName;
            document.getElementById('details-title').innerText = newName;
            saveProgress();
        }
    }

    function viewFullDetails() {
        if (!selectedBuilding) return;
        localStorage.setItem("selectedBuilding", JSON.stringify(selectedBuilding));
        window.location.href = "details.html";
    }

    function saveProgress() {
        localStorage.setItem('buildings', JSON.stringify(buildings));
    }

    function loadProgress() {
        let savedBuildings = JSON.parse(localStorage.getItem('buildings'));
        if (savedBuildings) buildings = savedBuildings;
    }

    window.onload = function() {
        loadProgress();
    };
</script>

</body>
</html>
